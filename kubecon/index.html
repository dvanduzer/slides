<!doctype html><head><script src="../eveal.js/eveal.js"></script></head><body>
<style>code { background-color:#eee; color:#900; }</style>


# KubeCon 2018
## Seattle, WA

<small>
  @tracey_pooh
  <br/>

  2018 December
</small>

<small>
  _?_ for keyboard shortcuts
</small><br/>
https://github.com/traceypooh/slides

---
# The Internet Archive
## moving to Kubernetes

---
# Coming soon!
<img height="500" data-src="NWL_Press_DontIronWhileStrikeisHot_122116.jpg"/>

---
# compare www-xxx -v- review apps

---
- we are more comfortable still with block-device storage than torrented pieces for entire archives
  - eg: S3/EC2 => K8 or o/w -- seems anxiety++

---
# LB vs ingress for alt ports
- `kubectl expose -ndweb deployment/production --type=LoadBalancer --name=porter`
- `kubectl patch  -ndweb svc/porter -p='{"spec":{"externalIPs":["'${K8_INGRESS_IP?}"]}}'`

---
# monorepo speed++
- `test` phase first = faster (when possible)
- takeover git mgmt
- build/test code in same tree
  - RUN move up to master head first
  - RUN reinvoke build script (now at master) where moves tree pointer back to $COMMIT

---
# monorepo .git
- `git shallow clone`
- `git checkout --detach ..  &&  git fetch ..  &&  git checkout ..`
- git 'advertised' commits
  ```omnibus_gitconfig['system'] = {"uploadpack" => ["allowReachableSHA1InWant = true"]}```
- `build` pull from prior build saved in registry

---
# kubeadm 'on prem' K8 cluster from scratch
- https://gitlab.com/internetarchive/kre8
  - shows/uses GitLab 'Auto DevOps' CI/CD end-to-end
  - coworker can try out - low committment

---
# top tips
- POSTGRES_ENABLED=false / PV
  - can use simple `localstorage` for 1 (tainted) or 2-node k8 clusters
- remove old replicasets, trim registry periodically
- GitLab API for last master `test` status



---
<!-- .slide: data-background="https://media.giphy.com/media/Gdjgn0hy8zBRK/giphy.gif" -->
# The End

